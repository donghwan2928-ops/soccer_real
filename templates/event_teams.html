{% extends "base.html" %}

{% block content %}
    <h1>ê²½ê¸°ë³„ íŒ€ ìë™ ë°°ì •</h1>

    <a class="btn" href="/events/{{ event.id }}">â¬… ê²½ê¸° ìƒì„¸ë¡œ ëŒì•„ê°€ê¸°</a>
    <a class="btn secondary" href="/events" style="margin-left:8px;">ì¼ì • ëª©ë¡</a>

    <hr>

   <h2>âš½ íŒ€ ë‚˜ëˆ„ê¸°</h2>
	<div style="margin-bottom: 15px;">
    		<a href="/events/{{ event.id }}/teams/saved" class="btn">
      	  		ğŸ“‚ ì €ì¥ëœ íŒ€ ëª©ë¡ ë³´ê¸°
    		</a>
		<a href="/events/{{ event.id }}/teams/graph" class="btn" style="margin-top:10px;">
    ğŸ“Š ê·¸ë˜í”„ë¡œ ë³´ê¸°
</a>

	</div>

    <p><strong>ë‚ ì§œ/ì‹œê°„:</strong> {{ event.date or "-" }}</p>
    <p><strong>ì¥ì†Œ:</strong> {{ event.place or "-" }}</p>

    <hr>

    {% if not attendees %}
        <p>ì´ ê²½ê¸°ì—ì„œ <strong>ì°¸ì„(yes)</strong>ìœ¼ë¡œ í‘œì‹œëœ ë¶€ì›ì´ ì—†ìŠµë‹ˆë‹¤.</p>
        <p>ë¨¼ì € <a href="/events/{{ event.id }}">ê²½ê¸° ìƒì„¸ í˜ì´ì§€</a>ì—ì„œ ì°¸ì„ ì—¬ë¶€ë¥¼ ì„¤ì •í•´ ì£¼ì„¸ìš”.</p>
    {% else %}
        <h3>ì°¸ì„ì ({{ attendees|length }}ëª…)</h3>
        <ul>
            {% for m in attendees %}
                <li>
                    {{ m.name }} ({{ m.position or "í¬ì§€ì…˜ ì—†ìŒ" }}, ì‹¤ë ¥ {{ m.skill or 0 }})
                </li>
            {% endfor %}
        </ul>

        <hr>

        <form method="post" action="/events/{{ event.id }}/teams" style="margin-top:12px; margin-bottom:16px;">
            <label>íŒ€ ê°œìˆ˜ ì„ íƒ</label><br>
            <select name="team_count"
                    style="padding:8px; border-radius:8px; border:1px solid #d1d5db; margin-top:4px;">
                <option value="2">2íŒ€</option>
                <option value="3">3íŒ€</option>
            </select>
            <button type="submit" class="btn" style="margin-left:8px;">íŒ€ ë°°ì •í•˜ê¸°</button>
        </form>

        {% if teams %}
            <h3>ë°°ì • ê²°ê³¼</h3>

            <div style="display:flex; gap:16px; flex-wrap:wrap; margin-top:8px;">
                {% for team in teams %}
                    <div style="flex:1 1 250px; border:1px solid #e5e7eb; border-radius:12px; padding:16px; box-shadow:0 2px 6px rgba(0,0,0,0.04);">
                        <h4>íŒ€ {{ loop.index }}</h4>
                        <p style="font-size:14px; color:#6b7280;">
                            ì´ ì‹¤ë ¥ í•©: {{ team.total_skill }}
                            (ì¸ì› {{ team.members|length }}ëª…)
                        </p>
                        <ul>
                            {% for m in team.members %}
                                <li>
                                    {{ m.name }}
                                    ({{ m.position or "í¬ì§€ì…˜ ì—†ìŒ" }}, ì‹¤ë ¥ {{ m.skill or 0 }})
                                </li>
                            {% endfor %}
                        </ul>
                    </div>
                {% endfor %}
            </div>
        {% else %}
            <p style="margin-top:8px; color:#6b7280;">
                íŒ€ ë°°ì •ì„ í•˜ë ¤ë©´ ìœ„ì—ì„œ íŒ€ ê°œìˆ˜ë¥¼ ì„ íƒí•˜ê³  ë²„íŠ¼ì„ ëˆŒëŸ¬ ì£¼ì„¸ìš”.
            </p>
        {% endif %}
    {% endif %}

{% endblock %}

<form method="post" action="/events/{{ event.id }}/teams/save" style="margin-top:8px;">
    <input type="hidden" name="team_count" value="2" id="save_team_count_input">
    <button type="submit" class="btn secondary" style="margin-left:8px;">ì´ ê²°ê³¼ ì €ì¥í•˜ê¸°</button>
</form>

<script>
    (function(){
        const select = document.querySelector('form[action="/events/{{ event.id }}/teams"] select[name="team_count"]');
        const saveInput = document.getElementById('save_team_count_input');
        if(select && saveInput){
            select.addEventListener('change', ()=>{ saveInput.value = select.value; });
            saveInput.value = select.value;
        }
    })();
</script>
